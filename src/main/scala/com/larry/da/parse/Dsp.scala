package com.larry.da.parse

import java.util.Comparator

import sun.jvmstat.monitor.event.VmListener

//  import com.agrantsem.dm.util.{LogParseUtil => U}
import com.larry.da.util.{LogParseUtil => U}
import org.apache.spark.SparkContext
import com.google.common.hash.Hashing.md5


/**
  * Created by larry on 24/2/16.
  */
class Dsp {
  var sc: SparkContext = _

  //  import com.agrantsem.dm.util.{LogParseUtil => U}
  def TagStatic(channel:String, time:String) ={
    /*
      val channel = "baidu"
      val time ="2016-03-22-09"
    */
    val rdd = U.dspRdd(sc,"bidder",channel,time)
    val bidderFields = "userId,usertags".split(",")
    val data = rdd.map(x=>{
      val d = U.bidderLog(x);
      val Array(cid,tags) = bidderFields.map(k=>{val v =d.getOrElse(k, ""); if(v=="null") "" else v})
      val tagList = if(tags.length >= 2) tags.substring(1,tags.length-1).replace("\"","") else ""
      val tag = if (tagList.length > 0) 1 else 0
      val newTag = if(tagList.contains("{X")) 1 else 0
      (cid,(tag,newTag,1))
    })

    val res = data.reduceByKey((a,b)=>(a._1 + b._1,a._2 + b._2,a._3 + b._3),200).flatMap(x=>{
      val (cid,(tag,newTag,all)) = x
      Array(
        "all" ->(1,all),
        "tag" ->(if(tag>0) 1 else 0,tag),
        "newtag" ->(if(newTag > 0) 1 else 0,newTag)
      )
    }).reduceByKey((a,b)=>(a._1 + b._1,a._2 + b._2)).sortByKey().map(x=>{
      val(key,(uv,pv))=x
      Array(channel + "_" +time+ "_" + key,uv,pv,"-").mkString(",")
    })//.foreach(println)
    res
  }






  def run_TagStatic(): Unit = {
    val time = "2016-03-17-10"
    sc.union(
      "baidu,tanx".split(",").map(channel => TagStatic(channel, time))
    ).collect().foreach(println)

    sc.union(
      "bid".split(",").map(channel => TagStatic(channel, time))
    ).collect().foreach(println)


  }

  def static_baidu_bidder_user_count(): Unit ={

    import com.google.common.hash.Hashing.md5
    val days = "16,15,14,13,12,11,10".split(",")
    val list = days.map(day=>{
      val path = s"/user/dsp/bidder_agg/baidu/agg/2016-03-$day*/data/req"
      println(path)
      val log = sc.textFile(path).map(x=>{
        val arr = x.split("\t")
        if(arr.size > 1)
          md5.hashString(arr.head).asLong()
        else
          0L
      }).filter(_ != 0 ).distinct(200)
      log
    })


    val res2 = list.tail.map(list.head.intersection(_).count())
    val res1 = list.map(_.count)

    days zip res1 foreach(println)
    days.tail zip res2 foreach(println)

  }



  def tt(): Unit ={
    import scala.tools.reflect.ToolBox
    val tb = scala.reflect.runtime.universe.runtimeMirror(getClass.getClassLoader).mkToolBox()
    tb.parse("for ((name,\"female\") <- Set(\"wang\"->\"male\",\"zhang\"->\"female\") ) print(name)")

  }
/*
  import com.agrantsem.dm.util.{LogParseUtil => U}
  import com.google.common.hash.Hashing.md5
 */

  def static_tag_v_count(channel:String, time:String)={
      /*
      val channel = "baidu"
      val time ="2016-03-22-09"
      */
      val rdd =sc.union( time.split(",").map(hour => U.dspRdd(sc,"bidder",channel,hour)) )
      val bidderFields = "userId,usertags".split(",")
      val data = rdd.flatMap(x=>{
        val d = U.bidderLog(x);
        val Array(cid,usertags) = bidderFields.map(k=>{val v =d.getOrElse(k, ""); if(v=="null") "" else v})
        val tags = if(usertags.length >= 2) usertags.substring(1,usertags.length-1) else ""
        val vList = tags.split("\",\"").filter(_.contains("{X:DI")).map(_.split(",V:",2).last.split(",",2).head).toList
        val id = md5.hashString(cid).asLong()
        ( "All" :: vList).map(v=>(id,v) -> 1)
      })

      val res = data.reduceByKey(_+_,800).map(x=>{
        val((id,v),num) = x;
        v -> (1,num)
      }).reduceByKey((a,b)=>(a._1 + b._1,a._2 + b._2)).sortByKey().map(x=>{
        val(key,(uv,pv))=x
        Array(channel + "_" +time+ "_" + key,uv,pv).mkString("\t")
      })
      res
  }

  def run_static_tag_v_count: Unit ={

    val ucld = "baidu,tanx".split(",").map(channel =>{
      static_tag_v_count(channel,"2016-03-24").collect()
    })
    ucld.foreach(arr=> arr.foreach(println _))


    val aws = "aws".split(",").map(channel =>{
      static_tag_v_count(channel,"2016-03-24").collect()
    })
    aws.foreach(arr=> arr.foreach(println _))

  }

  def tt5(): Unit ={
    val idmap = "0201\t汽车\n0201\t汽车\n0203\t配件\n0299\t其他\n1503\t军事\n1504\t行政\n16\t新闻\n16\t新闻\n16\t新闻\n0704\t投资\n0704\t投资\n0702\t理财\n1105\t房产装修\n0705\t保险\n07\t金融\n07\t金融\n0602\t电脑\n0601\t手机\n0603\t电子消费品\n0604\t软件\n06\tIT数码\n06\tIT数码\n1012\t健康状况\n1012\t健康状况\n0303\t美容护理\n1012\t健康状况\n10\t医疗健康\n0102\t影视\n0101\t音乐\n01\t娱乐\n01\t娱乐\n01\t娱乐\n01\t娱乐\n09\t游戏\n1104\t宠物与动物\n01\t娱乐\n01\t娱乐\n1102\t社交\n1102\t社交\n1102\t社交\n1102\t社交\n1401\t学前教育\n1402\t在校学生\n1402\t在校学生\n1404\t职业培训\n1403\t成人教育\n1403\t成人教育\n1403\t成人教育\n14\t教育\n1101\t家具家电\n1101\t家具家电\n1105\t房产装修\n1101\t家具家电\n1101\t家具家电\n1902\t运动\n1902\t运动\n1902\t运动\n1902\t运动\n1902\t运动\n1901\t体育用品\n1901\t体育用品\n2002\t住宿\n2004\t服务\n2004\t服务\n0304\t服装配饰\n0303\t美容护理\n0301\t母婴儿童\n21\t求职招聘\n21\t求职招聘\n21\t求职招聘\n0801\t食品\n0801\t食品\n0802\t饮品\n0802\t饮品\n08\t食品饮品\n08\t食品饮品\n1801\t服饰\n1801\t服饰\n1801\t服饰\n1801\t服饰\n1801\t服饰\n18\t购物\n1805\t奢侈品\n18\t购物\n0502\t工业\n0502\t工业\n0501\t农业\n0502\t工业\n1107\t服务\n1107\t服务"
    val data = "baidu_2016-03-22-09_01\t335,742 \t4,862,715 \nbaidu_2016-03-22-09_0100\t902 \t8,987 \nbaidu_2016-03-22-09_0101\t191,251 \t2,787,478 \nbaidu_2016-03-22-09_0102\t2,752,951 \t53,202,540 \nbaidu_2016-03-22-09_0103\t58,194 \t799,357 \nbaidu_2016-03-22-09_0104\t728,232 \t10,890,049 \nbaidu_2016-03-22-09_0105\t388,672 \t5,344,332 \nbaidu_2016-03-22-09_0106\t21,016 \t356,686 \nbaidu_2016-03-22-09_0199\t950,946 \t17,361,316 \nbaidu_2016-03-22-09_02\t80,627 \t1,271,133 \nbaidu_2016-03-22-09_0200\t3,404 \t40,926 \nbaidu_2016-03-22-09_0201\t176,189 \t2,793,337 \nbaidu_2016-03-22-09_0202\t587 \t6,331 \nbaidu_2016-03-22-09_0203\t11,483 \t228,164 \nbaidu_2016-03-22-09_0299\t148,640 \t2,105,590 \nbaidu_2016-03-22-09_0300\t1,075 \t8,798 \nbaidu_2016-03-22-09_0301\t34,710 \t475,218 \nbaidu_2016-03-22-09_0302\t49,067 \t750,888 \nbaidu_2016-03-22-09_0303\t81,115 \t1,418,705 \nbaidu_2016-03-22-09_0304\t252,906 \t5,588,038 \nbaidu_2016-03-22-09_0399\t141,833 \t2,773,499 \nbaidu_2016-03-22-09_04\t44,640 \t552,531 \nbaidu_2016-03-22-09_0400\t1,789 \t15,453 \nbaidu_2016-03-22-09_0402\t9,364 \t117,468 \nbaidu_2016-03-22-09_0403\t291 \t3,181 \nbaidu_2016-03-22-09_0404\t13,035 \t149,804 \nbaidu_2016-03-22-09_0499\t1,069,284 \t16,285,226 \nbaidu_2016-03-22-09_05\t2,298 \t30,413 \nbaidu_2016-03-22-09_0500\t477 \t5,675 \nbaidu_2016-03-22-09_0501\t23,203 \t385,595 \nbaidu_2016-03-22-09_0502\t249,959 \t4,063,172 \nbaidu_2016-03-22-09_0503\t142,356 \t1,731,210 \nbaidu_2016-03-22-09_0599\t1,694 \t20,535 \nbaidu_2016-03-22-09_06\t62,580 \t641,758 \nbaidu_2016-03-22-09_0600\t1,569 \t23,777 \nbaidu_2016-03-22-09_0601\t30,324 \t506,317 \nbaidu_2016-03-22-09_0602\t107,963 \t1,426,627 \nbaidu_2016-03-22-09_0603\t56,449 \t699,045 \nbaidu_2016-03-22-09_0604\t318,894 \t3,766,800 \nbaidu_2016-03-22-09_0699\t440,072 \t6,095,453 \nbaidu_2016-03-22-09_07\t4,037 \t42,565 \nbaidu_2016-03-22-09_0700\t1,857 \t26,870 \nbaidu_2016-03-22-09_0701\t8,417 \t106,357 \nbaidu_2016-03-22-09_0702\t6,342 \t84,629 \nbaidu_2016-03-22-09_0703\t17,141 \t189,028 \nbaidu_2016-03-22-09_0704\t366,075 \t5,552,514 \nbaidu_2016-03-22-09_0705\t4,373 \t63,281 \nbaidu_2016-03-22-09_0799\t45,481 \t721,157 \nbaidu_2016-03-22-09_08\t1,517 \t16,691 \nbaidu_2016-03-22-09_0800\t2,199 \t19,207 \nbaidu_2016-03-22-09_0801\t75,882 \t1,261,471 \nbaidu_2016-03-22-09_0802\t5,468 \t109,037 \nbaidu_2016-03-22-09_0803\t51,357 \t733,794 \nbaidu_2016-03-22-09_0804\t6,941 \t87,100 \nbaidu_2016-03-22-09_0899\t2,739 \t64,816 \nbaidu_2016-03-22-09_09\t605,599 \t7,758,749 \nbaidu_2016-03-22-09_0900\t489 \t6,226 \nbaidu_2016-03-22-09_0901\t104,640 \t1,162,176 \nbaidu_2016-03-22-09_0999\t72,830 \t871,724 \nbaidu_2016-03-22-09_10\t15,597 \t257,607 \nbaidu_2016-03-22-09_1000\t12,432 \t140,925 \nbaidu_2016-03-22-09_1011\t22,224 \t403,184 \nbaidu_2016-03-22-09_1012\t603,407 \t11,890,045 \nbaidu_2016-03-22-09_1013\t708 \t9,400 \nbaidu_2016-03-22-09_1014\t27,159 \t564,209 \nbaidu_2016-03-22-09_1099\t16,928 \t340,407 \nbaidu_2016-03-22-09_1100\t929 \t15,334 \nbaidu_2016-03-22-09_1101\t55,867 \t773,355 \nbaidu_2016-03-22-09_1102\t2,681,301 \t49,183,861 \nbaidu_2016-03-22-09_1103\t103,068 \t1,578,724 \nbaidu_2016-03-22-09_1104\t28,723 \t466,713 \nbaidu_2016-03-22-09_1105\t343,015 \t4,184,227 \nbaidu_2016-03-22-09_1199\t2,831,277 \t45,410,244 \nbaidu_2016-03-22-09_1200\t2,336 \t32,139 \nbaidu_2016-03-22-09_1201\t56,203 \t812,146 \nbaidu_2016-03-22-09_1202\t62,617 \t838,081 \nbaidu_2016-03-22-09_13\t20,147 \t197,830 \nbaidu_2016-03-22-09_1300\t770 \t6,994 \nbaidu_2016-03-22-09_1301\t964,103 \t13,419,886 \nbaidu_2016-03-22-09_1302\t1,653 \t18,563 \nbaidu_2016-03-22-09_1399\t191,672 \t2,376,089 \nbaidu_2016-03-22-09_14\t102 \t829 \nbaidu_2016-03-22-09_1400\t761 \t6,926 \nbaidu_2016-03-22-09_1401\t380,855 \t4,159,945 \nbaidu_2016-03-22-09_1402\t603,588 \t7,362,193 \nbaidu_2016-03-22-09_15\t419 \t4,469 \nbaidu_2016-03-22-09_1500\t4,118 \t46,153 \nbaidu_2016-03-22-09_1501\t27,393 \t403,048 \nbaidu_2016-03-22-09_1502\t15,992 \t265,291 \nbaidu_2016-03-22-09_1503\t934,589 \t25,630,634 \nbaidu_2016-03-22-09_1504\t541,081 \t7,997,905 \nbaidu_2016-03-22-09_1599\t4,297 \t54,489 \nbaidu_2016-03-22-09_16\t1,595,613 \t26,677,771 \nbaidu_2016-03-22-09_1600\t982 \t11,647 \nbaidu_2016-03-22-09_1700\t12,718 \t176,288 \nbaidu_2016-03-22-09_1701\t129,527 \t2,389,528 \nbaidu_2016-03-22-09_1702\t32,469 \t522,207 \nbaidu_2016-03-22-09_1703\t74,048 \t954,029 \nbaidu_2016-03-22-09_1704\t267,907 \t3,630,257 \nbaidu_2016-03-22-09_18\t1,563 \t12,609 \nbaidu_2016-03-22-09_1800\t1,776 \t20,173 \nbaidu_2016-03-22-09_1801\t75,787 \t925,174 \nbaidu_2016-03-22-09_1802\t91,644 \t1,021,495 \nbaidu_2016-03-22-09_1803\t2,875 \t30,141 \nbaidu_2016-03-22-09_1805\t4,877 \t67,966 \nbaidu_2016-03-22-09_1899\t59,575 \t851,000 \nbaidu_2016-03-22-09_19\t124,215 \t1,325,433 \nbaidu_2016-03-22-09_1900\t7,955 \t113,728 \nbaidu_2016-03-22-09_1901\t2,383 \t17,881 \nbaidu_2016-03-22-09_1902\t205,718 \t2,655,450 \nbaidu_2016-03-22-09_1903\t6,016 \t51,027 \nbaidu_2016-03-22-09_1999\t88,391 \t1,068,244 \nbaidu_2016-03-22-09_20\t13,638 \t228,825 \nbaidu_2016-03-22-09_2000\t1,534 \t18,923 \nbaidu_2016-03-22-09_2001\t58,411 \t901,133 \nbaidu_2016-03-22-09_2002\t64,412 \t820,590 \nbaidu_2016-03-22-09_2003\t17,403 \t366,680 \nbaidu_2016-03-22-09_2004\t223,856 \t2,967,413 \nbaidu_2016-03-22-09_2005\t311 \t5,919 \nbaidu_2016-03-22-09_2099\t456 \t3,887 \nbaidu_2016-03-22-09_2100\t2,404 \t44,805 \nbaidu_2016-03-22-09_2200\t142 \t1,754 \nbaidu_2016-03-22-09_2300\t162 \t1,298 \nbaidu_2016-03-22-09_2400\t1,169 \t12,278 \nbaidu_2016-03-22-09_2500\t170 \t1,866 \nbaidu_2016-03-22-09_All\t16,936,894 \t184,998,286 \nbaidu_2016-03-22-10_01\t337,442 \t4,844,038 \nbaidu_2016-03-22-10_0100\t989 \t10,631 \nbaidu_2016-03-22-10_0101\t201,971 \t3,073,199 \nbaidu_2016-03-22-10_0102\t2,827,449 \t55,107,241 \nbaidu_2016-03-22-10_0103\t60,368 \t828,231 \nbaidu_2016-03-22-10_0104\t741,325 \t11,109,914 \nbaidu_2016-03-22-10_0105\t403,216 \t5,521,752 \nbaidu_2016-03-22-10_0106\t21,704 \t387,590 \nbaidu_2016-03-22-10_0199\t981,650 \t18,278,141 \nbaidu_2016-03-22-10_02\t81,923 \t1,283,190 \nbaidu_2016-03-22-10_0200\t3,691 \t46,727 \nbaidu_2016-03-22-10_0201\t181,205 \t2,917,613 \nbaidu_2016-03-22-10_0202\t569 \t6,132 \nbaidu_2016-03-22-10_0203\t11,822 \t243,009 \nbaidu_2016-03-22-10_0299\t153,344 \t2,207,701 \nbaidu_2016-03-22-10_0300\t1,109 \t10,748 \nbaidu_2016-03-22-10_0301\t37,277 \t506,521 \nbaidu_2016-03-22-10_0302\t50,990 \t781,322 \nbaidu_2016-03-22-10_0303\t83,008 \t1,491,111 \nbaidu_2016-03-22-10_0304\t256,904 \t5,810,948 \nbaidu_2016-03-22-10_0399\t144,350 \t2,853,438 \nbaidu_2016-03-22-10_04\t46,558 \t579,774 \nbaidu_2016-03-22-10_0400\t1,984 \t18,706 \nbaidu_2016-03-22-10_0402\t9,875 \t133,569 \nbaidu_2016-03-22-10_0403\t286 \t2,908 \nbaidu_2016-03-22-10_0404\t13,481 \t154,210 \nbaidu_2016-03-22-10_0499\t1,113,691 \t17,236,472 \nbaidu_2016-03-22-10_05\t2,336 \t29,621 \nbaidu_2016-03-22-10_0500\t502 \t6,456 \nbaidu_2016-03-22-10_0501\t24,749 \t409,335 \nbaidu_2016-03-22-10_0502\t254,572 \t4,220,037 \nbaidu_2016-03-22-10_0503\t145,438 \t1,756,383 \nbaidu_2016-03-22-10_0599\t1,723 \t22,181 \nbaidu_2016-03-22-10_06\t63,293 \t648,883 \nbaidu_2016-03-22-10_0600\t1,559 \t25,259 \nbaidu_2016-03-22-10_0601\t31,773 \t542,091 \nbaidu_2016-03-22-10_0602\t112,424 \t1,474,456 \nbaidu_2016-03-22-10_0603\t58,155 \t722,248 \nbaidu_2016-03-22-10_0604\t335,084 \t4,031,763 \nbaidu_2016-03-22-10_0699\t470,807 \t6,555,771 \nbaidu_2016-03-22-10_07\t4,120 \t48,547 \nbaidu_2016-03-22-10_0700\t1,772 \t22,803 \nbaidu_2016-03-22-10_0701\t8,746 \t107,746 \nbaidu_2016-03-22-10_0702\t6,241 \t89,933 \nbaidu_2016-03-22-10_0703\t17,505 \t185,169 \nbaidu_2016-03-22-10_0704\t341,262 \t5,462,000 \nbaidu_2016-03-22-10_0705\t4,584 \t62,058 \nbaidu_2016-03-22-10_0799\t46,634 \t761,305 \nbaidu_2016-03-22-10_08\t1,448 \t20,014 \nbaidu_2016-03-22-10_0800\t2,359 \t18,630 \nbaidu_2016-03-22-10_0801\t77,833 \t1,312,005 \nbaidu_2016-03-22-10_0802\t5,744 \t118,905 \nbaidu_2016-03-22-10_0803\t53,317 \t777,585 \nbaidu_2016-03-22-10_0804\t7,188 \t85,328 \nbaidu_2016-03-22-10_0899\t2,950 \t70,928 \nbaidu_2016-03-22-10_09\t676,908 \t8,799,860 \nbaidu_2016-03-22-10_0900\t511 \t5,065 \nbaidu_2016-03-22-10_0901\t115,804 \t1,282,345 \nbaidu_2016-03-22-10_0999\t76,149 \t904,356 \nbaidu_2016-03-22-10_10\t14,800 \t250,532 \nbaidu_2016-03-22-10_1000\t13,259 \t152,308 \nbaidu_2016-03-22-10_1011\t22,257 \t413,211 \nbaidu_2016-03-22-10_1012\t630,632 \t12,803,773 \nbaidu_2016-03-22-10_1013\t812 \t11,193 \nbaidu_2016-03-22-10_1014\t27,413 \t592,494 \nbaidu_2016-03-22-10_1099\t17,583 \t362,564 \nbaidu_2016-03-22-10_1100\t985 \t15,791 \nbaidu_2016-03-22-10_1101\t55,921 \t794,924 \nbaidu_2016-03-22-10_1102\t2,713,377 \t50,703,252 \nbaidu_2016-03-22-10_1103\t105,868 \t1,609,685 \nbaidu_2016-03-22-10_1104\t29,228 \t494,753 \nbaidu_2016-03-22-10_1105\t348,976 \t4,256,742 \nbaidu_2016-03-22-10_1199\t2,901,700 \t46,894,091 \nbaidu_2016-03-22-10_1200\t2,415 \t35,059 \nbaidu_2016-03-22-10_1201\t58,472 \t843,716 \nbaidu_2016-03-22-10_1202\t64,720 \t874,215 \nbaidu_2016-03-22-10_13\t20,975 \t205,545 \nbaidu_2016-03-22-10_1300\t832 \t8,008 \nbaidu_2016-03-22-10_1301\t985,054 \t13,755,508 \nbaidu_2016-03-22-10_1302\t1,756 \t20,996 \nbaidu_2016-03-22-10_1399\t194,137 \t2,396,973 \nbaidu_2016-03-22-10_14\t106 \t793 \nbaidu_2016-03-22-10_1400\t754 \t8,194 \nbaidu_2016-03-22-10_1401\t404,011 \t4,470,552 \nbaidu_2016-03-22-10_1402\t633,649 \t7,776,815 \nbaidu_2016-03-22-10_15\t425 \t4,721 \nbaidu_2016-03-22-10_1500\t4,344 \t50,073 \nbaidu_2016-03-22-10_1501\t27,686 \t405,757 \nbaidu_2016-03-22-10_1502\t15,962 \t264,454 \nbaidu_2016-03-22-10_1503\t971,509 \t28,060,785 \nbaidu_2016-03-22-10_1504\t550,803 \t8,218,177 \nbaidu_2016-03-22-10_1599\t4,513 \t60,342 \nbaidu_2016-03-22-10_16\t1,592,793 \t27,060,615 \nbaidu_2016-03-22-10_1600\t1,023 \t11,865 \nbaidu_2016-03-22-10_1700\t12,783 \t173,361 \nbaidu_2016-03-22-10_1701\t133,176 \t2,527,704 \nbaidu_2016-03-22-10_1702\t33,765 \t549,413 \nbaidu_2016-03-22-10_1703\t76,392 \t981,547 \nbaidu_2016-03-22-10_1704\t279,380 \t3,816,769 \nbaidu_2016-03-22-10_18\t1,718 \t13,393 \nbaidu_2016-03-22-10_1800\t1,844 \t20,220 \nbaidu_2016-03-22-10_1801\t79,786 \t955,759 \nbaidu_2016-03-22-10_1802\t95,074 \t1,047,054 \nbaidu_2016-03-22-10_1803\t2,708 \t28,558 \nbaidu_2016-03-22-10_1805\t4,876 \t69,855 \nbaidu_2016-03-22-10_1899\t61,149 \t862,337 \nbaidu_2016-03-22-10_19\t130,053 \t1,393,154 \nbaidu_2016-03-22-10_1900\t8,043 \t112,159 \nbaidu_2016-03-22-10_1901\t2,355 \t20,343 \nbaidu_2016-03-22-10_1902\t214,512 \t2,815,005 \nbaidu_2016-03-22-10_1903\t6,049 \t49,484 \nbaidu_2016-03-22-10_1999\t94,518 \t1,201,967 \nbaidu_2016-03-22-10_20\t14,177 \t245,202 \nbaidu_2016-03-22-10_2000\t1,607 \t19,253 \nbaidu_2016-03-22-10_2001\t59,669 \t919,458 \nbaidu_2016-03-22-10_2002\t64,527 \t826,169 \nbaidu_2016-03-22-10_2003\t18,280 \t402,334 \nbaidu_2016-03-22-10_2004\t230,081 \t3,110,635 \nbaidu_2016-03-22-10_2005\t336 \t5,544 \nbaidu_2016-03-22-10_2099\t487 \t3,999 \nbaidu_2016-03-22-10_2100\t2,460 \t46,225 \nbaidu_2016-03-22-10_2200\t130 \t1,756 \nbaidu_2016-03-22-10_2300\t170 \t1,652 \nbaidu_2016-03-22-10_2400\t1,170 \t13,142 \nbaidu_2016-03-22-10_2500\t203 \t2,026 \nbaidu_2016-03-22-10_All\t17,570,323 \t196,356,581 \nbaidu_2016-03-22-16_01\t327,636 \t4,428,708 \nbaidu_2016-03-22-16_0100\t1,451 \t15,872 \nbaidu_2016-03-22-16_0101\t210,960 \t3,090,256 \nbaidu_2016-03-22-16_0102\t2,955,621 \t53,881,116 \nbaidu_2016-03-22-16_0103\t64,757 \t826,280 \nbaidu_2016-03-22-16_0104\t737,456 \t10,510,953 \nbaidu_2016-03-22-16_0105\t402,500 \t5,269,644 \nbaidu_2016-03-22-16_0106\t21,415 \t378,639 \nbaidu_2016-03-22-16_0199\t998,602 \t17,648,963 \nbaidu_2016-03-22-16_02\t78,422 \t1,176,894 \nbaidu_2016-03-22-16_0200\t4,132 \t49,679 \nbaidu_2016-03-22-16_0201\t181,047 \t2,842,423 \nbaidu_2016-03-22-16_0202\t584 \t7,201 \nbaidu_2016-03-22-16_0203\t10,958 \t198,390 \nbaidu_2016-03-22-16_0299\t152,700 \t2,208,137 \nbaidu_2016-03-22-16_0300\t1,172 \t11,854 \nbaidu_2016-03-22-16_0301\t37,737 \t464,947 \nbaidu_2016-03-22-16_0302\t51,231 \t733,495 \nbaidu_2016-03-22-16_0303\t80,634 \t1,355,910 \nbaidu_2016-03-22-16_0304\t241,826 \t5,244,341 \nbaidu_2016-03-22-16_0399\t138,636 \t2,558,806 \nbaidu_2016-03-22-16_04\t48,766 \t567,779 \nbaidu_2016-03-22-16_0400\t2,171 \t20,581 \nbaidu_2016-03-22-16_0402\t10,128 \t128,644 \nbaidu_2016-03-22-16_0403\t296 \t2,899 \nbaidu_2016-03-22-16_0404\t13,286 \t139,912 \nbaidu_2016-03-22-16_0499\t1,136,250 \t16,871,953 \nbaidu_2016-03-22-16_05\t2,160 \t28,165 \nbaidu_2016-03-22-16_0500\t483 \t7,134 \nbaidu_2016-03-22-16_0501\t22,891 \t350,197 \nbaidu_2016-03-22-16_0502\t251,564 \t3,947,910 \nbaidu_2016-03-22-16_0503\t144,961 \t1,679,103 \nbaidu_2016-03-22-16_0599\t1,663 \t18,355 \nbaidu_2016-03-22-16_06\t63,339 \t617,605 \nbaidu_2016-03-22-16_0600\t1,709 \t25,731 \nbaidu_2016-03-22-16_0601\t31,368 \t526,257 \nbaidu_2016-03-22-16_0602\t112,296 \t1,413,193 \nbaidu_2016-03-22-16_0603\t55,987 \t646,179 \nbaidu_2016-03-22-16_0604\t343,413 \t4,075,907 \nbaidu_2016-03-22-16_0699\t493,776 \t6,633,711 \nbaidu_2016-03-22-16_07\t3,625 \t44,463 \nbaidu_2016-03-22-16_0700\t1,796 \t23,565 \nbaidu_2016-03-22-16_0701\t8,770 \t98,665 \nbaidu_2016-03-22-16_0702\t5,942 \t81,932 \nbaidu_2016-03-22-16_0703\t17,191 \t182,774 \nbaidu_2016-03-22-16_0704\t344,895 \t5,455,817 \nbaidu_2016-03-22-16_0705\t4,356 \t54,469 \nbaidu_2016-03-22-16_0799\t46,048 \t724,046 \nbaidu_2016-03-22-16_08\t1,476 \t18,361 \nbaidu_2016-03-22-16_0800\t2,478 \t22,945 \nbaidu_2016-03-22-16_0801\t74,220 \t1,191,712 \nbaidu_2016-03-22-16_0802\t5,561 \t103,673 \nbaidu_2016-03-22-16_0803\t54,101 \t731,550 \nbaidu_2016-03-22-16_0804\t6,924 \t76,975 \nbaidu_2016-03-22-16_0899\t3,156 \t72,944 \nbaidu_2016-03-22-16_09\t922,745 \t10,673,383 \nbaidu_2016-03-22-16_0900\t525 \t5,890 \nbaidu_2016-03-22-16_0901\t137,909 \t1,466,265 \nbaidu_2016-03-22-16_0999\t81,253 \t885,773 \nbaidu_2016-03-22-16_10\t13,967 \t219,522 \nbaidu_2016-03-22-16_1000\t14,437 \t165,508 \nbaidu_2016-03-22-16_1011\t21,553 \t368,653 \nbaidu_2016-03-22-16_1012\t641,903 \t12,456,001 \nbaidu_2016-03-22-16_1013\t814 \t9,676 \nbaidu_2016-03-22-16_1014\t25,599 \t497,036 \nbaidu_2016-03-22-16_1099\t16,929 \t309,431 \nbaidu_2016-03-22-16_1100\t1,025 \t17,038 \nbaidu_2016-03-22-16_1101\t50,840 \t746,915 \nbaidu_2016-03-22-16_1102\t2,713,932 \t48,891,199 \nbaidu_2016-03-22-16_1103\t107,059 \t1,527,433 \nbaidu_2016-03-22-16_1104\t29,548 \t456,408 \nbaidu_2016-03-22-16_1105\t336,352 \t4,127,301 \nbaidu_2016-03-22-16_1199\t2,918,577 \t45,566,933 \nbaidu_2016-03-22-16_1200\t2,574 \t37,453 \nbaidu_2016-03-22-16_1201\t57,465 \t790,824 \nbaidu_2016-03-22-16_1202\t63,356 \t807,525 \nbaidu_2016-03-22-16_13\t21,351 \t202,547 \nbaidu_2016-03-22-16_1300\t947 \t9,259 \nbaidu_2016-03-22-16_1301\t978,506 \t13,195,749 \nbaidu_2016-03-22-16_1302\t1,802 \t21,731 \nbaidu_2016-03-22-16_1399\t191,889 \t2,325,757 \nbaidu_2016-03-22-16_14\t88 \t627 \nbaidu_2016-03-22-16_1400\t888 \t9,438 \nbaidu_2016-03-22-16_1401\t400,358 \t4,536,180 \nbaidu_2016-03-22-16_1402\t646,942 \t7,711,342 \nbaidu_2016-03-22-16_15\t410 \t4,409 \nbaidu_2016-03-22-16_1500\t4,866 \t57,811 \nbaidu_2016-03-22-16_1501\t27,453 \t390,115 \nbaidu_2016-03-22-16_1502\t16,163 \t246,042 \nbaidu_2016-03-22-16_1503\t962,311 \t26,862,796 \nbaidu_2016-03-22-16_1504\t544,587 \t7,838,224 \nbaidu_2016-03-22-16_1599\t4,418 \t56,119 \nbaidu_2016-03-22-16_16\t1,591,780 \t26,162,693 \nbaidu_2016-03-22-16_1600\t1,060 \t10,521 \nbaidu_2016-03-22-16_1700\t13,527 \t184,605 \nbaidu_2016-03-22-16_1701\t131,212 \t2,342,697 \nbaidu_2016-03-22-16_1702\t33,332 \t492,739 \nbaidu_2016-03-22-16_1703\t77,605 \t945,295 \nbaidu_2016-03-22-16_1704\t282,272 \t3,679,252 \nbaidu_2016-03-22-16_18\t1,731 \t12,996 \nbaidu_2016-03-22-16_1800\t1,921 \t20,897 \nbaidu_2016-03-22-16_1801\t82,276 \t891,829 \nbaidu_2016-03-22-16_1802\t94,165 \t995,997 \nbaidu_2016-03-22-16_1803\t2,222 \t26,716 \nbaidu_2016-03-22-16_1805\t4,264 \t54,156 \nbaidu_2016-03-22-16_1899\t59,443 \t777,735 \nbaidu_2016-03-22-16_19\t134,909 \t1,407,467 \nbaidu_2016-03-22-16_1900\t8,262 \t115,324 \nbaidu_2016-03-22-16_1901\t1,899 \t16,791 \nbaidu_2016-03-22-16_1902\t215,416 \t2,702,443 \nbaidu_2016-03-22-16_1903\t5,835 \t51,785 \nbaidu_2016-03-22-16_1999\t93,588 \t1,259,975 \nbaidu_2016-03-22-16_20\t13,487 \t226,034 \nbaidu_2016-03-22-16_2000\t1,607 \t18,687 \nbaidu_2016-03-22-16_2001\t59,493 \t881,253 \nbaidu_2016-03-22-16_2002\t61,552 \t784,504 \nbaidu_2016-03-22-16_2003\t17,900 \t375,523 \nbaidu_2016-03-22-16_2004\t223,514 \t3,040,402 \nbaidu_2016-03-22-16_2005\t339 \t5,765 \nbaidu_2016-03-22-16_2099\t505 \t4,409 \nbaidu_2016-03-22-16_2100\t2,606 \t51,673 \nbaidu_2016-03-22-16_2200\t134 \t1,556 \nbaidu_2016-03-22-16_2300\t194 \t2,502 \nbaidu_2016-03-22-16_2400\t1,268 \t15,433 \nbaidu_2016-03-22-16_2500\t198 \t2,241 \nbaidu_2016-03-22-16_All\t19,001,584 \t214,569,977 "

    val dic = idmap.split("\n").map(x=>{val arr = x.split("\t");arr(0) -> arr(1)}).toMap

    data.split("\n").map(x=>{
      val arr = x.split("\t");
      val key = arr(0).split("_").last
      val v = if(key == "All") key else dic.getOrElse(key,"ignore")

      x.replace(s"_${key}\t",s"_${v}\t")
    }).filter(! _.contains("_ignore")).foreach(println)
  }


}
